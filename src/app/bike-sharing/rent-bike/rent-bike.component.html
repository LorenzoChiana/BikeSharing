<!doctype html>
<html lang="en">
<head>
<title>Rent-Bike</title>
<meta charset="utf-8">
</head>
<style>
agm-map {
  width: 100%;
  height: 50vh;
}

/* css mappa */
#mapView {
  margin-top: 2%;
  margin-bottom: 2%;

  padding-top: 2%;
  padding-bottom: 2%;
}

</style>
<body>

<div class="container">
  <!-- pulsanti navigazione -->
  <div class="tool-bar">
    <button (click)="goBack()">Indietro</button>
    <button (click)="rackList()">Parcheggi</button>
    <button (click)="preleva()">Preleva</button>
    <button (click)="rilascia()">Rilascia</button>
    <button (click)="rentList()">Prenotazioni</button>
    <button (click)="commentList()">Commenti</button>
  </div>

  <!-- titolo -->
  <div class="titolo">
    <button *ngIf="showMap" (click)="toggleMap()">Elenco</button>
    <button *ngIf="!showMap" (click)="toggleMap()">Mappa</button>
    <h1 style="color:white;">Seleziona Bici da: {{curRack.codice}}-{{curRack.indirizzo}}</h1>
  </div>

<!-- mappa bici -->

  <div *ngIf="showMap" class="map-responsive" id="mapView">
    <img src="http://maps.google.com/mapfiles/ms/icons/blue-dot.png">  Parcheggi bici
    <img src="http://maps.google.com/mapfiles/ms/icons/green-dot.png">  Bici disponibili
    <img src="http://maps.google.com/mapfiles/ms/icons/red-dot.png">  Bici in uso
  <agm-map [latitude]="latitudine" [longitude]="longitudine" [zoom]="zoom"
           [fullscreenControl]='true' [mapTypeControl]='true'>

    <agm-marker *ngFor="let kk of bikeRack; let ind = index"
    [latitude]="kk.latitudine" [longitude]="kk.longitudine"
    [label]="kk.codice"
    [markerDraggable]="isAdmin"
    (dragEnd)="dragBike($event, kk)"
    (markerClick)="selectBike(kk, 0)"
    color="black"
    [iconUrl]="'http://maps.google.com/mapfiles/ms/icons/green-dot.png'"></agm-marker>

    <agm-marker *ngFor="let kk of bikeUser; let ind = index"
    [latitude]="kk.latitudine" [longitude]="kk.longitudine"
    [label]="kk.codice"
    [markerDraggable]="true"
    (dragEnd)="dragBike($event, kk)"
    (markerClick)="selectBike(kk, 1)"
    color="black"
    [iconUrl]="'http://maps.google.com/mapfiles/ms/icons/red-dot.png'"></agm-marker>

    <agm-marker *ngFor="let kk of racks; let ind = index"
    [latitude]="kk.latitudine" [longitude]="kk.longitudine"
    [label]="kk.codice"
    [markerDraggable]="false"
    (markerClick)="selectRack(kk)"
    color="black"
    [iconUrl]="'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'"></agm-marker>

    <agm-marker *ngIf="currentLat && currentLong"
    [latitude]="currentLat" [longitude]="currentLong" [label]="labelOptions"
    [iconUrl]="'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'"></agm-marker>

  </agm-map>
</div>

<!-- elenco bici -->
<div class="table-container" style="overflow: auto;">
  <table class="table">
    <thead>
      <tr>
        <td>Id</td>
        <td>Codice</td>
        <td>Stato</td>
        <td>Km</td>
        <td *ngIf="isAdmin">Rack</td>
        <td>Commenti</td>
        <td *ngIf="!isAdmin">Operazioni</td>
        <td *ngIf="isAdmin">Edit</td>
      </tr>
    </thead>
    <tbody>

      <!-- bici utente -->
      <tr *ngFor="let kk of bikeUser;let ind = index">
        <td>{{ind + 1}}</td>
        <td>{{kk.codice}}</td>
        <td>{{kk.stato}}</td>
        <td>{{kk.totKm}}</td>
        <!-- commenti -->
        <td><a [routerLink]="['/view-comment', kk.codice]" routerLinkActive="active">Commenti</a></td>
        <td><button type="button" class="btn btn-danger" (click)="selectBike(kk,1)">Rilascia</button></td>
      </tr>

      <!-- bici del rack -->
        <tr *ngFor="let kk of bikeRack;let ind = index">
          <td *ngIf="isAdmin || kk.stato == 'libero'">{{ind + 1}}</td>
          <td *ngIf="isAdmin || kk.stato == 'libero'">{{kk.codice}}</td>
          <td *ngIf="isAdmin || kk.stato == 'libero'">{{kk.stato}}</td>
          <td *ngIf="isAdmin || kk.stato == 'libero'">{{kk.totKm}}</td>
          <td *ngIf="isAdmin">{{kk.rack}}</td>

          <!-- commenti -->
          <td><a [routerLink]="['/view-comment', kk.codice]" routerLinkActive="active">Commenti</a></td>

          <td *ngIf="!isAdmin && kk.stato == 'libero'">
            <button type="button" class="btn btn-success" data-toggle="modal"
            (click)="selectBike(kk,0)" data-target="#myModal">Preleva</button>
          </td>

          <td *ngIf="!isAdmin && (kk.stato != 'libero' && kk.stato != nameUser)"><a style="color:red">Non disponibile</a></td>
          <td *ngIf="isAdmin">
            <button type="button" class="btn btn-primary btn-sm" (click)="editBike(kk)">Edit</button>
          </td>

        </tr>
    </tbody>
  </table>
</div>

</div>

</body>
</html>
